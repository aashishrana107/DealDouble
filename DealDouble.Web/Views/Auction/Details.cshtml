@model DealDouble.Web.ViewModels.AuctionDetailViewModel

<div class="row">

    <div class="col-lg-12">


        <div class="card mt-4">

            @if (Model.Auction.AuctionPictures != null && Model.Auction.AuctionPictures.Count > 0)
            {
                var firstAuctionPicture = Model.Auction.AuctionPictures.First();
                var i = 0;
                <div id="carouselIndicators" class="carousel slide my-4" data-ride="carousel">
                    <ol class="carousel-indicators">
                        @foreach (var picture in Model.Auction.AuctionPictures)
                        {
                            var active = picture == firstAuctionPicture ? "active" : string.Empty;
                            <li class="@active" data-target="#carouselIndicators" data-slide-to="@i"></li>
                            i++;
                        }

                    </ol>
                    <div class="carousel-inner" role="listbox">
                        @foreach (var picture in Model.Auction.AuctionPictures)
                        {

                            var active = picture == firstAuctionPicture ? "active" : string.Empty;

                            var picURL = "/Content/images/" + picture.Picture.URL;
                            <div class="carousel-item @active">
                                <img class="d-block img-fluid" src="@picURL">
                            </div>
                        }
                    </div>
                    <a class="carousel-control-prev" href="#carouselIndicators" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselIndicators" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>

            }
            <div class="card-body">
                <h3 class="card-title">@Model.Auction.Title</h3>
                <h4>
                    $@Model.BidsAmount
                    @if(Model.LatestBidder != null)
                    {
                       <text>
                        [@Model.LatestBidder.UserName] 
                       </text>
                    }

                </h4>
                <p class="card-text">@Model.Auction.Description</p>
                <span class="text-warning">&#9733; &#9733; &#9733; &#9733; &#9734;</span>
                4.0 stars
            </div>
            <div class="card-footer text-muted">
                <button type="button" class="btn btn-success" id="btnBidNow"> Bid Now</button>
              
            </div>
        </div>



        <!-- /.card -->

        <div class="card card-outline-secondary my-4">
            <div class="card-header">
                Comments
            </div>
            <div class="card-body">
                @if (Model.Comments != null && Model.Comments.Count > 0)
                {
                    foreach (var comment in Model.Comments)
                    {
                        <p>@comment.Text</p>
                        <small class="text-muted">Posted by @comment.UserID on @comment.TimeStamp</small>
                        <hr/>
                    }
                }
                else
                {
                    <p>There is no comment </p>
                    <hr />
                }

                
                <hr>

                <form id="CommentForm">
                    <input type="hidden" name="EntityID" value="@Model.EntityID" />
                    <input type="hidden" name="RecordID" value="@Model.Auction.ID" />

                    <div class="form-group">
                        <label>Write Your Comment</label>
                        <textarea placeholder="Write Your Comment Here" class="form-control" name="Text" rows="3"></textarea>
                    </div>
                    <button type="button" id="btnComment" class="btn btn-success">Leave a Review</button>
                </form>

            </div>
        </div>
        <!-- /.card -->

    </div>
    <!-- /.col-lg-9 -->

</div>

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
    $("#btnBidNow").click(function () {
        debugger;
        $.ajax({
            url: "@Url.Action("Bid","Bids")",
            type: "post",
            data: {
                ID: '@Model.Auction.ID'
            }
        }).done(function (response) {
                debugger;
                if (response.Success)
                {
                    window.location.reload();
                }
                else {
                    swal("Error !", response.Message, "error");
                }
            }).fail(function () {
                swal("Error !", "Error Occured . Please Try Again later", "error");
            });
    });


    $("#btnComment").click(function () {
        debugger;
        $.ajax({
            url: "@Url.Action("LeaveComment", "Shared")",
            type: "post",
            data: $('#CommentForm').serialize()
        }).done(function (response) {
            debugger
                if (response.Success)
                {
                    window.location.reload();
                }
                else {
                    swal("Error !", response.Message, "error");
                }
            }).fail(function () {
                swal("Error !", "Error Occured . Please Try Again later", "error");
            });
    });

    
</script>